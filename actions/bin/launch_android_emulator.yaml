name: Launch Android emulator
description: Launches an Android emulator and caches it for further action runs
inputs:
  api-level:
    description: "API level of the platform and system image - e.g. 23 for Android Marshmallow, 29 for Android 10"
    default: "33"
  target:
    description: "target of the system image - default, google_apis, google_apis_playstore, aosp_atd, google_atd, android-wear, android-wear-cn, android-tv or google-tv"
    default: google_apis
  abi:
    description: "ABI of the Android system image - x86, x86_64 or arm64-v8a. Defaults to the host architecture."
  script:
    required: true
    description: The script to run once the emulator is booted.
  emulator-boot-timeout:
    default: 600000
    description: "Timeout for emulator boot in milliseconds"
runs:
  using: "composite"
  steps:
    - name: Enable KVM group permissions
      if: runner.os == 'Linux'
      shell: bash
      run: |
        echo 'KERNEL=="kvm", GROUP="kvm", MODE="0666", OPTIONS+="static_node=kvm"' | sudo tee /etc/udev/rules.d/99-kvm4all.rules
        sudo udevadm control --reload-rules
        sudo udevadm trigger --name-match=kvm

    - name: Launch Android emulator
      uses: node16
      with:
        entrypoint: dist/index.mjs
      env:
        INPUT_API-LEVEL: ${{ inputs.api-level }}
        INPUT_TARGET: ${{ inputs.target }}
        INPUT_ABI: ${{ inputs.abi }}
        INPUT_SCRIPT: ${{ inputs.script }}
        INPUT_EMULATOR-BOOT-TIMEOUT: ${{ inputs.emulator-boot-timeout }}
